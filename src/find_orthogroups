import glob
from datetime import date

# Make sure to replace test directories later
# TODO - annotate this better lmao
SPECIES = glob_wildcards('../data/proteome_pairs/{sp_name}_S_cere').sp_name

ORTHOFINDER_FILES = glob.glob('../data/proteome_pairs/*_S_cere/Ortho*/Results*/Work*')

RESULTS_FOLDER = date.today().strftime("/Results_%b%d")

ORTHOFINDER_ORTHOGROUP_DATA = [f + "/OrthoFinder" for f in ORTHOFINDER_FILES]

SCO_CSV_FILES = expand('../results/{sp_name}_S_cere_SCOs.csv', sp_name=SPECIES)


# Annotation
rule all:
    input: SCO_CSV_FILES


# Annotation
rule find_orthofinder_orthogroups:
    input: ORTHOFINDER_FILES
    output: directory(ORTHOFINDER_ORTHOGROUP_DATA)
    shell:
        """
        for f in {input}
        do
            orthofinder -og -b $f
        done
        """


# Annotation
rule get_single_copy_orthogroups:
    input: ORTHOFINDER_ORTHOGROUP_DATA
    output: SCO_CSV_FILES
    shell:
        """
        for f in {input}
        do
            Rscript ./get_single_copy_orthogroups.R $f{RESULTS_FOLDER}
        done
        """

# Remove all outputs generated by this snakefile
rule clean:
    shell:
        """
        rm -r {ORTHOFINDER_ORTHOGROUP_DATA} &&\
        rm -r {SCO_CSV_FILES}
        """